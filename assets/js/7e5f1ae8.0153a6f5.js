"use strict";(self.webpackChunklinux_tutorial=self.webpackChunklinux_tutorial||[]).push([[979],{4442:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var s=t(4848),a=t(8453);const o={title:"Network security"},r=void 0,i={id:"network-security",title:"Network security",description:"The following information is solely for learning purposes. Test them on a",source:"@site/docs/network-security.md",sourceDirName:".",slug:"/network-security",permalink:"/linux/network-security",draft:!1,unlisted:!1,editUrl:"https://github.com/pranabdas/linux/blob/main/docs/network-security.md",tags:[],version:"current",frontMatter:{title:"Network security"},sidebar:"docs",previous:{title:"Firewall",permalink:"/linux/firewall"},next:{title:"Key management",permalink:"/linux/key-management"}},c={},d=[{value:"Address Resolution Protocol (ARP)",id:"address-resolution-protocol-arp",level:2},{value:"Lynis",id:"lynis",level:2},{value:"Nmap",id:"nmap",level:2},{value:"nikto",id:"nikto",level:2},{value:"Wireshark",id:"wireshark",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"The following information is solely for learning purposes. Test them on a\nsystem / network that you own or have explicit permission to carry out such\ntests."}),"\n",(0,s.jsxs)(n.p,{children:["Many building blocks of the internet was not designed with security in mind.\nThere exists a trove of vulnerabilities not only in the implementation but also\nin the formulation. In layer 2 (of 7 layer ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/OSI_model",children:"OSI model"}),") which includes Wi-Fi and LAN networks\nare basically broadcast medium, meaning every packet is available to every other\nmember of the network. Each device is identified by its MAC address. Once the\nource and destination MAC address matches it moves to the IP (layer 3) layers.\nAnyone can turn his/her device's promiscuous mode on, and sniff every packet\npasses through the entire network. Later we will use ",(0,s.jsx)(n.a,{href:"https://www.wireshark.org",children:"Wireshark"})," and see it ourselves."]}),"\n",(0,s.jsx)(n.p,{children:"The defence against sniffing is encryption. A good program (e.g., Signal) always\nencrypts the messages end-to-end. A good bank website server will only allow\nconnection over https. A common misconception is that https is always safe. That\nis not true. It only means that the connection between your browser and the\nserver is made via a secure protocol, and it's hard for the sniffing attackers\nto decipher the traffic, however a malicious or vulnerable webserver still could\nexpose your information, so always be careful which website you visit and trust."}),"\n",(0,s.jsx)(n.p,{children:"Different layers have their own headers, and many of these headers are visible\nto anyone in the network. Luckily, nowadays most of the websites encrypt the\nactual data they transport between client and server. However, still it might\nreveal a lot of metadata."}),"\n",(0,s.jsxs)("picture",{children:[(0,s.jsx)("source",{type:"image/webp",srcSet:t(4230).A}),(0,s.jsx)("img",{src:t(9557).A,alt:"network-headers"})]}),"\n",(0,s.jsx)(n.h2,{id:"address-resolution-protocol-arp",children:"Address Resolution Protocol (ARP)"}),"\n",(0,s.jsx)(n.p,{children:"This is used by the devices in the same LAN or Wi-Fi network to discover each\nother. Check the devices' IP address and MAC address mapping in your network:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"arp -a\n"})}),"\n",(0,s.jsx)(n.p,{children:"Here we have a possibility of man-in-the-middle attacks. Can you make your\nfriend's computer believe that you are the router, and make router believe that\nyou are your friend's computer? Then you sit in the traffic between your\nfriend's computer and the router. When your friend tries to visit a website,\nyou send a forged webpage asking to login, once he/she submits username and\npassword, you get them. In fact, from next step onwards you handover the real\ntraffic so he/she does not suspect anything. Understand the risk of joining a\npublic network or where there is possibility of an adversary present in the\nnetwork."}),"\n",(0,s.jsx)(n.p,{children:"Now, let's move on to the next layer, the IP network layer (layer 3). Every\nnetwork devices participates in this layer, be it a laptop, phone, router,\nserver, smart TV, fridge, or even today's hair driers. Every device has its\nunique IP address (e.g., 192.29.277.32 or more recent IPv6 addresses\n2001:0db8:85a3:0000:0000:8a2e:0370:7334). Traffic flows between one IP address\nto another, say your phone running Facebook app and its server in California.\nAnyone sits in-between this two end points such as a router, your internet\nservice provider has the ability to intercept the traffic. So possibility of\nman-in-the-middle attack here too. There exists other vulnerabilities too other\nthan sniffing. It is very easy to change the source IP address in the header (by\ndesign of internet), and this leads to responses send back to wrong address.\nThis is how DoS attacks are launched. With large number of bogus responses, you\ncan overload a server and deny access to legitimate connections."}),"\n",(0,s.jsx)(n.p,{children:"Check if a server is running:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ping www.example.com\n"})}),"\n",(0,s.jsx)(n.p,{children:"Some more details on the server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dig www.example.com\n"})}),"\n",(0,s.jsx)(n.p,{children:"Trace route the connection path:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"traceroute www.example.com\n"})}),"\n",(0,s.jsxs)(n.p,{children:["However, it is not guaranteed that ",(0,s.jsx)(n.code,{children:"ping"})," or ",(0,s.jsx)(n.code,{children:"traceroute"})," will always respond.\nThey rely on ICMP signal, all server is not guaranteed to respond to them."]}),"\n",(0,s.jsx)(n.p,{children:"TCP (layer 4): This layer establishes the reliability of a connection. When a\nnew connection opens, there is a three-way-handshake to synchronize the\nconnection. Later on a sequence number is added to every packet, receiver knows\nwhat to expect and makes sure things are in order. For different process in the\nclient, there is a separate port numbers while the servers uses known ports,\ne.g., HTTP uses port 80, HTTPS port 443, SSH port 22. Although\nthree-way-handshake makes it hard to hijack a connection by IP spoofing, there\nis no defence against TCP injection by man-in-the-middle attacker. A\nman-in-the-middle can easily see source, destination ports and sequence numbers."}),"\n",(0,s.jsxs)(n.p,{children:["DNS (layer 5): there is a world wide network of servers that translates the\nwebsite addresses to IP addresses. Imagine what you could do if you gain access\nto the DNS resolution system? An user tries to visit his/her bank website, you\nreturn the IP address of a forged bank website. Currently there is no encryption\nused in DNS layer. It is only protected by the TCP/UDP layer encryption\ntherefore vulnerable to man-in-the-middle position attacks. Remember, last time\nyou connected to a Wi-Fi network in a restaurant, you tried to visit say\n",(0,s.jsx)(n.em,{children:"google.com"}),", but first it send you a form asking to give you name, phone\nnumber, once you enter, it redirects to intended ",(0,s.jsx)(n.em,{children:"google.com"})," (?). It is even\nabused by some authorities with help of ISPs."]}),"\n",(0,s.jsx)(n.h2,{id:"lynis",children:"Lynis"}),"\n",(0,s.jsxs)(n.p,{children:["Download Lynis ",(0,s.jsx)(n.a,{href:"https://cisofy.com/lynis/#download",children:"https://cisofy.com/lynis/"}),".\nUn-tar the package:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tar -zxvf lynis-3.0.0.tar.gz\ncd lynis\n./lynis audit system\n"})}),"\n",(0,s.jsx)(n.h2,{id:"nmap",children:"Nmap"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# On Ubuntu\nsudo apt install nmap\n\n# On CentOS/RHEL/Fedora\nsudo dnf install nmap\n\n# On macOS\nbrew install nmap\n"})}),"\n",(0,s.jsx)(n.p,{children:"Sample scan report:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ sudo nmap -Pn ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com\nStarting Nmap 7.70 ( https://nmap.org ) at 2020-07-23 10:02 UTC\nNmap scan report for ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com (xx.xxx.xx.xx)\nHost is up (0.0000030s latency).\nrDNS record for xx.xxx.xx.xx: ip-xx-xxx-xx-xx.ap-southeast-1.compute.internal\nNot shown: 997 closed ports\nPORT    STATE SERVICE\n22/tcp  open  ssh\n80/tcp  open  http\n443/tcp open  https\n\nNmap done: 1 IP address (1 host up) scanned in 1.60 seconds\n"})}),"\n",(0,s.jsxs)(n.p,{children:["By default it scans 1000 ports, there are 65,535 possible ports. If you have\nIPv6 addresses, use ",(0,s.jsx)(n.code,{children:"-6"})," flag."]}),"\n",(0,s.jsx)(n.p,{children:"Operating system detection:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ nmap -O ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com\nStarting Nmap 7.70 ( https://nmap.org ) at 2020-07-23 09:50 UTC\nNmap scan report for ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com (xx.xxx.xx.xx)\nHost is up (0.0000030s latency).\nrDNS record for xx.xxx.xx.xx: ip-xx-xxx-xx-xx.ap-southeast-1.compute.internal\nNot shown: 997 closed ports\nPORT    STATE SERVICE\n22/tcp  open  ssh\n80/tcp  open  http\n443/tcp open  https\nDevice type: general purpose\nRunning: Linux 3.X\nOS CPE: cpe:/o:linux:linux_kernel:3\nOS details: Linux 3.7 - 3.10\nNetwork Distance: 0 hops\n\nOS detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 3.89 seconds\n"})}),"\n",(0,s.jsx)(n.p,{children:"Unfortunately, it did not guess correctly the linux version."}),"\n",(0,s.jsx)(n.p,{children:"Service version detection:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ sudo nmap -sV ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com\nStarting Nmap 7.70 ( https://nmap.org ) at 2020-07-23 09:58 UTC\nNmap scan report for ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com (xx.xxx.xx.xx)\nHost is up (0.0000040s latency).\nrDNS record for xx.xxx.xx.xx: ip-xx-xxx-xx-xx.ap-southeast-1.compute.internal\nNot shown: 997 closed ports\nPORT    STATE SERVICE VERSION\n22/tcp  open  ssh     OpenSSH 8.0 (protocol 2.0)\n80/tcp  open  http    Apache httpd 2.4.37 ((Red Hat Enterprise Linux) OpenSSL/1.1.1c mod_fcgid/2.3.9)\n443/tcp open  ssl/ssl Apache httpd (SSL-only mode)\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 14.09 seconds\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This time not only it detected services, it also correctly identified the server Operating system. Scan a single port ",(0,s.jsx)(n.code,{children:"-p 80"})," or the whole range ",(0,s.jsx)(n.code,{children:"-p 1-65535"}),". We can get combine all methods using ",(0,s.jsx)(n.code,{children:"-A"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nmap -A -v -p 80 ec2-xx-xxx-xx-xx.ap-southeast-1.compute.amazonaws.com\n"})}),"\n",(0,s.jsx)(n.h2,{id:"nikto",children:"nikto"}),"\n",(0,s.jsx)(n.p,{children:"Nikto is a web vulnerability test utility. If you are on Ubuntu, you can simply install from the package manager."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo apt install nikto\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you are on RHEL or CentOS, you need to manually install."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo dnf install perl\ngit clone https://github.com/sullo/nikto\ncd nikto/program\nperl nikto.pl -h www.example.com\n"})}),"\n",(0,s.jsx)(n.p,{children:"There are additional dependencies for full functionality, please check the nikto\ndocumentation. Here is a sample output on a default apache server on latest\nRHEL:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ perl nikto.pl -h http://xx.xxx.xx.xx\n- Nikto v2.1.6\n---------------------------------------------------------------------------\n+ Target IP:          xx.xxx.xx.xx\n+ Target Hostname:    xx.xxx.xx.xx\n+ Target Port:        80\n+ Start Time:         2020-07-22 16:25:16 (GMT0)\n---------------------------------------------------------------------------\n+ Server: Apache/2.4.37 (Red Hat Enterprise Linux) OpenSSL/1.1.1c mod_fcgid/2.3.9\n+ The anti-clickjacking X-Frame-Options header is not present.\n+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS\n+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type.\n+ OpenSSL/1.1.1c appears to be outdated (current is at least 1.1.1g). OpenSSL 1.0.0o and 0.9.8zc are also current.\n+ Apache/2.4.37 appears to be outdated (current is at least Apache/2.4.43). Apache 2.2.34 is the EOL for the 2.x branch.\n+ mod_fcgid/2.3.9 appears to be outdated (current is at least 2.3.10-dev)\n+ Allowed HTTP Methods: POST, OPTIONS, HEAD, GET, TRACE\n+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST\n+ OSVDB-3092: /manual/: Web server manual found.\n+ OSVDB-3268: /icons/: Directory indexing found.\n+ OSVDB-3268: /manual/images/: Directory indexing found.\n+ OSVDB-3233: /icons/README: Apache default file found.\n+ 8894 requests: 0 error(s) and 12 item(s) reported on remote host\n+ End Time:           2020-07-22 16:25:30 (GMT0) (14 seconds)\n---------------------------------------------------------------------------\n+ 1 host(s) tested\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Now you get some idea to strengthen the security of your server. For example, my\nserver does not need ",(0,s.jsx)(n.code,{children:"TRACE"}),", ",(0,s.jsx)(n.code,{children:"POST"})," and ",(0,s.jsx)(n.code,{children:"OPTIONS"})," HTTP methods."]}),"\n",(0,s.jsxs)(n.p,{children:["We can add following to ",(0,s.jsx)(n.code,{children:"/etc/httpd/conf/httpd.conf"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"<Directory />\n    <LimitExcept GET HEAD>\n        deny from all\n    </LimitExcept>\n</Directory>\n\nTraceEnable Off\n"})}),"\n",(0,s.jsx)(n.p,{children:"Followed by:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo mv /etc/httpd/conf.d/manual.conf /etc/httpd/conf.d/manual.conf.bak\nsudo mv /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.bak\nsudo mv /etc/httpd/conf.d/autoindex.conf /etc/httpd/conf.d/autoindex.conf.bak\nsudo systemctl restart httpd\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now if we run nikto again, we will see that some of the issues are resolved."}),"\n",(0,s.jsx)(n.h2,{id:"wireshark",children:"Wireshark"}),"\n",(0,s.jsx)(n.p,{children:"Installing wireshark in Ubuntu:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo apt install wireshark\n"})}),"\n",(0,s.jsx)(n.p,{children:"During installation, it asked me configuration options. In case you need to\nreconfigure wireshark later or manually:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo dpkg-reconfigure wireshark-common\n"})}),"\n",(0,s.jsx)(n.p,{children:"Add user:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo adduser $USER wireshark\n"})}),"\n",(0,s.jsx)(n.p,{children:"Now we can launch wireshark:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wireshark &\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["If you are learning WireShark, there are various sample captures available at\n",(0,s.jsx)(n.a,{href:"https://packetlife.net/captures/",children:"https://packetlife.net/captures/"}),". You can open them in CloudShark from your\nbrowser, or download and open in WireShark."]})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},9557:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/network-headers-895858fc42f773eef3d2fd2d38be98e4.png"},4230:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/network-headers-0bbd4cf5bee71a5d184950ec565ebf73.webp"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var s=t(6540);const a={},o=s.createContext(a);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);