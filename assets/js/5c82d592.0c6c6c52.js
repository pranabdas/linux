"use strict";(self.webpackChunklinux_tutorial=self.webpackChunklinux_tutorial||[]).push([["1146"],{6649(e,n,a){a.r(n),a.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>i,contentTitle:()=>d,toc:()=>o,assets:()=>l});var t=JSON.parse('{"id":"vagrant","title":"Vagrant","description":"Vagrant commands","source":"@site/docs/31-vagrant.md","sourceDirName":".","slug":"/vagrant","permalink":"/linux/vagrant","draft":false,"unlisted":false,"editUrl":"https://github.com/pranabdas/linux/blob/main/docs/31-vagrant.md","tags":[],"version":"current","sidebarPosition":31,"frontMatter":{"title":"Vagrant"},"sidebar":"docs","previous":{"title":"LaTeX","permalink":"/linux/latex"},"next":{"title":"WSL","permalink":"/linux/wsl"}}'),r=a(4848),s=a(8453);let i={title:"Vagrant"},d,l={},o=[{value:"Vagrant commands",id:"vagrant-commands",level:2},{value:"Creating a VM",id:"creating-a-vm",level:3},{value:"Starting a VM",id:"starting-a-vm",level:3},{value:"Getting into a VM",id:"getting-into-a-vm",level:3},{value:"Stopping a VM",id:"stopping-a-vm",level:3},{value:"Cleaning Up a VM",id:"cleaning-up-a-vm",level:3},{value:"Boxes",id:"boxes",level:3},{value:"Tips",id:"tips",level:3},{value:"How to resize (expand) Vagrant/VirtualBox disk size?",id:"how-to-resize-expand-vagrantvirtualbox-disk-size",level:2},{value:"Vagrant plugin error after upgrading vagrant",id:"vagrant-plugin-error-after-upgrading-vagrant",level:2},{value:"Resources",id:"resources",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"vagrant-commands",children:"Vagrant commands"}),"\n",(0,r.jsxs)(n.p,{children:["Typing ",(0,r.jsx)(n.code,{children:"vagrant"})," from the command line will display a list of all available\ncommands."]}),"\n",(0,r.jsxs)(n.p,{children:["Be sure that you are in the same directory as the ",(0,r.jsx)(n.code,{children:"Vagrantfile"})," when running\nthese commands!"]}),"\n",(0,r.jsx)(n.h3,{id:"creating-a-vm",children:"Creating a VM"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant init"})}),(0,r.jsxs)(n.td,{children:["Initialize Vagrant with a ",(0,r.jsx)(n.code,{children:"Vagrantfile"})," and ",(0,r.jsx)(n.code,{children:"./.vagrant"})," directory, using no specified base image. Before you can do vagrant up, you'll need to specify a base image in the ",(0,r.jsx)(n.code,{children:"Vagrantfile"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant init <boxpath>"})}),(0,r.jsxs)(n.td,{children:["Initialize Vagrant with a specific box. To find a box, go to the ",(0,r.jsx)(n.a,{href:"https://app.vagrantup.com/boxes/search",children:"public Vagrant box catalog"}),". When you find one you like, just replace it's name with boxpath. For example, ",(0,r.jsx)(n.code,{children:"vagrant init almalinux/9"}),"."]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"starting-a-vm",children:"Starting a VM"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant up"})}),(0,r.jsx)(n.td,{children:"starts vagrant environment (also provisions only on the FIRST vagrant up)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant resume"})}),(0,r.jsx)(n.td,{children:"resume a suspended machine (vagrant up works just fine for this as well)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant provision"})}),(0,r.jsx)(n.td,{children:"forces reprovisioning of the vagrant machine"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant reload"})}),(0,r.jsx)(n.td,{children:"restarts vagrant machine, loads new Vagrantfile configuration"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant reload --provision"})}),(0,r.jsx)(n.td,{children:"restart the virtual machine and force"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"getting-into-a-vm",children:"Getting into a VM"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant ssh"})}),(0,r.jsx)(n.td,{children:"connects to machine via SSH"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant ssh <boxname>"})}),(0,r.jsx)(n.td,{children:"If you give your box a name in your Vagrantfile, you can ssh into it with boxname. Works from any directory."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"stopping-a-vm",children:"Stopping a VM"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant halt"})}),(0,r.jsx)(n.td,{children:"stops the vagrant machine"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant suspend"})}),(0,r.jsx)(n.td,{children:"suspends a virtual machine (remembers state)"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"cleaning-up-a-vm",children:"Cleaning Up a VM"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant destroy"})}),(0,r.jsx)(n.td,{children:"stops and deletes all traces of the vagrant machine"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant destroy -f"})}),(0,r.jsx)(n.td,{children:"same as above, without confirmation"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"boxes",children:"Boxes"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant box list"})}),(0,r.jsx)(n.td,{children:"see a list of all installed boxes on your computer"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant box add <name> <url>"})}),(0,r.jsx)(n.td,{children:"download a box image to your computer"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant box outdated"})}),(0,r.jsx)(n.td,{children:"check for updates vagrant box update"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant box remove <name>"})}),(0,r.jsx)(n.td,{children:"deletes a box from the machine"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant package"})}),(0,r.jsx)(n.td,{children:"packages a running virtualbox env in a reusable box"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"tips",children:"Tips"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant -v"})}),(0,r.jsx)(n.td,{children:"get the vagrant version"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant status"})}),(0,r.jsx)(n.td,{children:"outputs status of the vagrant machine"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant global-status"})}),(0,r.jsx)(n.td,{children:"outputs status of all vagrant machines"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant global-status --prune"})}),(0,r.jsx)(n.td,{children:"same as above, but prunes invalid entries"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant provision --debug"})}),(0,r.jsx)(n.td,{children:"use the debug flag to increase the verbosity of the output"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant push"})}),(0,r.jsxs)(n.td,{children:["yes, vagrant can be configured to ",(0,r.jsx)(n.a,{href:"http://docs.vagrantup.com/v2/push/index.html",children:"deploy code"}),"!"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"vagrant up --provision | tee provision.log"})}),(0,r.jsxs)(n.td,{children:["Runs ",(0,r.jsx)(n.code,{children:"vagrant up"}),", forces provisioning and logs all output to a file."]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"After destroying and cleaning up a vagrant project, you may need to manually\ncleanup:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"rm -rf ~/.vagrant.d\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Even after ",(0,r.jsx)(n.code,{children:"vagrant destroy"}),", vagrant often keeps some data cache. You may\nneed to manually delete a box from ",(0,r.jsx)(n.code,{children:"~/.vagrant.d/boxes/{BOX_NAME}"})," before\nre-creating with the same name."]})}),"\n",(0,r.jsx)(n.h2,{id:"how-to-resize-expand-vagrantvirtualbox-disk-size",children:"How to resize (expand) Vagrant/VirtualBox disk size?"}),"\n",(0,r.jsxs)(n.p,{children:["Install ",(0,r.jsx)(n.code,{children:"vagrant-disksize"})," plugin and set disk size:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Vagrantfile"',children:'Vagrant.configure(2) do |config|\n  config.vagrant.plugins = {\n      "vagrant-disksize" => {"version" => "0.1.3"},\n  }\n\n  config.disksize.size = "40GB"\n  ...\nend\n'})}),"\n",(0,r.jsx)(n.p,{children:"Bring up the vagrant box:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vagrant up <boxname>\n"})}),"\n",(0,r.jsx)(n.p,{children:"SSH to the box:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"vagrant ssh <boxname>\n"})}),"\n",(0,r.jsx)(n.p,{children:"List storage volumes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[root@master-vagrant-cluster-001 ~]# lsblk\nNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS\nloop0 7:0 0 40G 0 loop /export\nloop1 7:1 0 40G 0 loop /cluster-001-share\nloop2 7:2 0 40G 0 loop /backup\nsda 8:0 0 40G 0 disk\n\u251C\u2500sda1 8:1 0 1M 0 part\n\u251C\u2500sda2 8:2 0 200M 0 part /boot/efi\n\u251C\u2500sda3 8:3 0 1G 0 part /boot\n\u2514\u2500sda4 8:4 0 18.3G 0 part /\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[root@master-vagrant-cluster-001 ~]# parted /dev/sda print free\nWarning: Not all of the space available to /dev/sda appears to be used, you can fix the GPT to\nuse all of the space (an extra 42926080 blocks) or continue with the current setting?\nFix/Ignore? Fix\nModel: ATA VBOX HARDDISK (scsi)\nDisk /dev/sda: 42.9GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\n\nNumber Start End Size File system Name Flags\n17.4kB 1049kB 1031kB Free Space\n1 1049kB 2097kB 1049kB biosboot bios_grub\n2 2097kB 212MB 210MB fat16 EFI System Partition boot, esp\n3 212MB 1286MB 1074MB xfs boot\n4 1286MB 21.0GB 19.7GB xfs root\n21.0GB 42.9GB 22.0GB Free Space\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[root@master-vagrant-cluster-001 ~]# parted /dev/sda resizepart 4 100%\nWarning: Partition /dev/sda4 is being used. Are you sure you want to continue?\nYes/No? yes\nInformation: You may need to update /etc/fstab.\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[root@master-vagrant-cluster-001 ~]# parted /dev/sda print free\nModel: ATA VBOX HARDDISK (scsi)\nDisk /dev/sda: 42.9GB\nSector size (logical/physical): 512B/512B\nPartition Table: gpt\nDisk Flags:\n\nNumber Start End Size File system Name Flags\n17.4kB 1049kB 1031kB Free Space\n1 1049kB 2097kB 1049kB biosboot bios_grub\n2 2097kB 212MB 210MB fat16 EFI System Partition boot, esp\n3 212MB 1286MB 1074MB xfs boot\n4 1286MB 42.9GB 41.7GB xfs root\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"[root@master-vagrant-cluster-001 ~]# lsblk\nNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS\nloop0 7:0 0 40G 0 loop /export\nloop1 7:1 0 40G 0 loop /cluster-001-share\nloop2 7:2 0 40G 0 loop /backup\nsda 8:0 0 40G 0 disk\n\u251C\u2500sda1 8:1 0 1M 0 part\n\u251C\u2500sda2 8:2 0 200M 0 part /boot/efi\n\u251C\u2500sda3 8:3 0 1G 0 part /boot\n\u2514\u2500sda4 8:4 0 38.8G 0 part /\n"})}),"\n",(0,r.jsx)(n.p,{children:"Finally,"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"xfs_growfs -d /\n"})}),"\n",(0,r.jsx)(n.h2,{id:"vagrant-plugin-error-after-upgrading-vagrant",children:"Vagrant plugin error after upgrading vagrant"}),"\n",(0,r.jsx)(n.p,{children:"Error message:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Vagrant failed to initialize at a very early stage:\n\nThe plugins failed to initialize correctly. This may be due to manual\nmodifications made within the Vagrant home directory. Vagrant can\nattempt to automatically correct this issue by running:\n\n  vagrant plugin repair\n\nIf Vagrant was recently updated, this error may be due to incompatible\nversions of dependencies. To fix this problem please remove and re-install\nall plugins. Vagrant can attempt to do this automatically by running:\n\n  vagrant plugin expunge --reinstall\n\nOr you may want to try updating the installed plugins to their latest\nversions:\n\n  vagrant plugin update\n\nError message given during initialization: Unable to resolve dependency: user requested 'vagrant-cachier (= 1.2.1)'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To resolve this issue, rename (if you want to backup) or delete the existing\n",(0,r.jsx)(n.code,{children:".vagrant"})," directory in the project root."]}),"\n",(0,r.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://gist.github.com/wpscholar/a49594e2e2b918f4d0c4",children:"Vagrant command cheat sheet"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://medium.com/@kanrangsan/how-to-automatically-resize-virtual-box-disk-with-vagrant-9f0f48aa46b3",children:"How to automatically resize virtual box disk with vagrant"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,n,a){a.d(n,{R:()=>i,x:()=>d});var t=a(6540);let r={},s=t.createContext(r);function i(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);